<?php
require_once __DIR__ . '/../includes/config.php';

// If already logged in, redirect to dashboard
if (!empty($_SESSION['is_admin'])) {
    header('Location: /admin/dashboard.php');
    exit;
}

$errors = [];
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = trim($_POST['username'] ?? '');
    $password = trim($_POST['password'] ?? '');

    if ($username === ADMIN_USER && $password === ADMIN_PASS) {
        // Successful login
        $_SESSION['is_admin'] = true;
        // Optional: store admin username in session
        $_SESSION['admin_user'] = $username;
        header('Location: /admin/dashboard.php');
        exit;
    } else {
        $errors[] = 'Invalid username or password';
    }
}

$page_title = "Admin Login";
require_once __DIR__ . '/../includes/header.php';
?>
<section class="container">
  <h2>Admin Login</h2>
  <?php if (!empty($errors)): ?>
    <div class="card" style="background:#ffecec;border:1px solid #ffb6b6;color:#700;">
      <?php foreach ($errors as $err) echo '<p>' . htmlspecialchars($err) . '</p>'; ?>
    </div>
  <?php endif; ?>
  <form method="post" action="/admin/login.php" style="max-width:420px;">
    <label>Username
      <input name="username" required />
    </label>
    <label>Password
      <input name="password" type="password" required />
    </label>
    <button class="btn" type="submit">Sign in</button>
  </form>
</section>
<?php require_once __DIR__ . '/../includes/footer.php'; ?>